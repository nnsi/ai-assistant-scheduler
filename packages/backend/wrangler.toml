name = "ai-scheduler-api"
main = "src/index.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]

[[d1_databases]]
binding = "DB"
database_name = "ai-scheduler-db"
database_id = "local"
migrations_dir = "drizzle"

# KV Namespace for rate limiting (開発環境ではオプション)
# 本番では wrangler kv:namespace create "RATE_LIMIT_KV" で作成
# [[kv_namespaces]]
# binding = "RATE_LIMIT_KV"
# id = "xxx"

[vars]
FRONTEND_URL = "http://localhost:5173"
# モックAIを使用する場合は "true"（開発時のデフォルト）
USE_MOCK_AI = "true"
# ローカル開発用（本番では wrangler secret put で設定）
JWT_SECRET = "dev-jwt-secret-change-in-production"

# ============================================
# ステージング環境設定 (masterブランチ → stg)
# ============================================
[env.staging]
name = "ai-scheduler-api-stg"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "ai-scheduler-db-stg"
database_id = "YOUR_STAGING_DATABASE_ID"
migrations_dir = "drizzle"

# ステージング環境用 KV Namespace（レート制限用）
[[env.staging.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_STAGING_KV_ID"

[env.staging.vars]
USE_MOCK_AI = "false"
# FRONTEND_URL は GitHub Actions で設定

# ステージング環境シークレット（GitHub Actions経由で設定）
# OPENROUTER_API_KEY
# GOOGLE_CLIENT_ID
# GOOGLE_CLIENT_SECRET
# JWT_SECRET
# FRONTEND_URL

# ============================================
# 本番環境設定 (releaseブランチ → prod)
# ============================================
[env.production]
name = "ai-scheduler-api-prod"

[[env.production.d1_databases]]
binding = "DB"
database_name = "ai-scheduler-db-prod"
database_id = "YOUR_PRODUCTION_DATABASE_ID"
migrations_dir = "drizzle"

# 本番環境用 KV Namespace（レート制限用）
[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_PRODUCTION_KV_ID"

[env.production.vars]
USE_MOCK_AI = "false"
# FRONTEND_URL は GitHub Actions で設定

# 本番環境シークレット（GitHub Actions経由で設定）
# OPENROUTER_API_KEY
# GOOGLE_CLIENT_ID
# GOOGLE_CLIENT_SECRET
# JWT_SECRET
# FRONTEND_URL
