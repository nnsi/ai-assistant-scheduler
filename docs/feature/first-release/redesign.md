# AI検索機能のリデザイン

## 背景

当初の設計「予定 → キーワード提案 → 検索」では、チャットUI（Claude, ChatGPT等）との差別化が弱い。

ユーザーの本質的なペインを深掘りした結果、以下が判明：
- **「譲れないこだわり条件」に合う店/場所を探すのが大変**
- 毎回複数サイトを開いて、苦手なもの・子連れOK・営業日・口コミを確認している
- これをAIに任せられれば、検索時間を大幅に削減できる

## チャットUIとの差別化

| このアプリ | チャットUI |
|-----------|-----------|
| 事前条件をプロファイルとして保存 | 毎回「子供は3歳で、妻は甲殻類アレルギーで...」と説明 |
| 予定の日時を自動で考慮 | 毎回「1/4の日曜で」と説明 |
| 検索結果が予定に紐づいて残る | 会話が流れて消える |

## 設計方針

### 1. プロファイル（事前条件）

ユーザーの「こだわり条件」を事前に登録しておく。

#### 条件の種類

| 種類 | 例 | 扱い |
|------|------|------|
| **必須条件** | アレルギー、子連れOK、営業日 | 合致しなければ除外 |
| **優先条件** | 個室、駅近、予約不要 | あれば優先、なくてもOK |
| **主観条件** | 清潔感、雰囲気、接客 | 口コミから判断して除外 |

#### プロファイルの項目例

```
家族構成:
  - 大人2名
  - 子供1名（3歳）

食事に関する条件:
  必須:
    - 甲殻類アレルギー対応
    - 子連れOK
  優先:
    - 個室あり
    - 駅近（徒歩5分以内）
  NG:
    - 清潔感に問題ありの口コミがある店

旅行に関する条件:
  必須:
    - 子供向けサービスあり
  優先:
    - 料理が美味しいと評判
    - 部屋食または個室食
```

### 2. 検索フロー

```
┌─────────────────────────────────┐
│  プロファイル（事前条件）        │
│  - 家族構成、アレルギー         │
│  - 必須条件、優先条件           │
│  - 主観条件（清潔感など）       │
└─────────────┬───────────────────┘
              ↓ 自動適用
┌─────────────────────────────────┐
│  予定入力                       │
│  「新宿 ランチ」                │
└─────────────┬───────────────────┘
              ↓
    ┌─────────┴─────────┐
    ↓                   ↓
 目的明確            ふわっと
    ↓                   ↓
 直接検索          キーワード提案
    ↓                   ↓
 条件に合う店だけ    方向性を選ぶ
 口コミも確認済み        ↓
                    選んだら検索
```

### 3. 使い分け

| 状況 | 使う機能 |
|------|---------|
| **目的が明確** | 事前条件を適用して直接検索 |
| 例: 「新宿でランチ」 | → 子連れOK、アレルギー考慮して結果出す |
| **ふわっとしてる** | キーワード提案で方向性を決める |
| 例: 「週末どこか行きたい」 | → イベント？新スポット？季節モノ？ |

### 4. AIエージェントの役割

#### 検索エージェント

- プロファイルの条件を受け取る
- 検索結果を条件でフィルタリング
- **口コミを確認し、必須条件に合致していない口コミがあれば除外**
- 優先条件に合致する店を上位に

#### キーワード提案エージェント

- ふわっとした予定に対して「何を検索すればいいか」を提案
- 季節のイベント、新スポット、定番などの方向性を示す

## 実装ステップ（案）

1. **プロファイル機能**
   - DB: usersテーブルにprofile列追加 or 別テーブル
   - API: プロファイルCRUD
   - UI: 設定画面

2. **検索エージェントの改修**
   - プロファイル情報を受け取るようにプロンプト修正
   - 口コミ確認ロジックの追加

3. **UI改修**
   - 目的明確な時: キーワード選択をスキップして直接検索
   - ふわっとした時: 従来通りキーワード提案から

## 今日の改善（2026-01-03）

プロンプト改修により以下を改善済み：

- キーワード提案: タイトルと重複しない、日時を考慮、検索で使える形式
- 検索結果: 個別ページURLを出す、営業時間を調べる、休業日の店を除外

これらはプロファイル機能実装後も引き続き有効。
