# AI Assistant Scheduler - 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
**AI Assistant Scheduler**

### 1.2 コンセプト
スケジュール登録時にAIが補足情報を自動リサーチして付加するカレンダーアプリ

### 1.3 解決する課題
- 予定を入れたとき、関連情報を別途調べる手間がかかる
- 調べた情報がスケジュールと紐づかず散逸する
- 後から「何を調べたか」を思い出せない

---

## 2. ユーザーストーリー

### メインフロー
1. ユーザーがスケジュール（タイトル + 日時）を入力
2. AIがタイトルを解析し「調べられそうなこと」を提案
3. ユーザーが調べたい項目を選択
4. AIがWeb検索等で情報を収集
5. 結果を補足情報としてスケジュールに保存
6. ユーザーが後から閲覧・メモ追記可能

### 具体例

#### 例1: レストラン探し
| ステップ | 内容 |
|---------|------|
| 入力 | 1月10日 12:00「都内 レストラン 新宿」 |
| AI提案 | 「5000円前後」「3000円前後」「デート」「家族利用」「イタリアン」... |
| ユーザー選択 | 「家族利用」「3000円前後」「イタリアン」 |
| AI出力 | 条件に合うレストランのリスト、口コミ、予約情報など |

#### 例2: 旅行計画
| ステップ | 内容 |
|---------|------|
| 入力 | 1月10日「一泊二日 箱根 二人」 |
| AI提案 | 「温泉」「食事」「移動手段」「予算」「観光スポット」... |
| ユーザー選択 | 「温泉」「移動手段」 |
| AI出力 | おすすめ温泉宿、電車/車でのアクセス方法など |

---

## 3. 機能要件

### 3.1 MVP（最小限の製品）

#### カレンダー機能
- [ ] 月表示カレンダー
- [ ] スケジュールの作成（タイトル + 日時）
- [ ] スケジュールの編集・削除
- [ ] スケジュール一覧表示

#### AI補足情報機能
- [ ] タイトル解析 → キーワード提案（AI）
- [ ] ユーザーによるキーワード選択
- [ ] 選択キーワード + 日時でWeb検索（AI Tool）
- [ ] 検索結果の整形・保存

#### 補足情報表示
- [ ] カレンダー上でポップアップ表示
- [ ] テキストでメモ追記可能（Markdown形式で表示）

### 3.2 将来追加予定

| 機能 | 説明 |
|------|------|
| 自由キーワード入力 | AI提案に加えて自分でキーワード追加 |
| 再提案機能 | 方向性を示して再度キーワード提案を受ける |
| 週表示・日表示 | カレンダーの表示形式追加 |
| 繰り返し予定 | 毎週・毎月などの繰り返し |
| ユーザー認証 | ログイン機能 |
| 複数デバイス同期 | クラウド保存による同期 |

---

## 4. 非機能要件

### 4.1 ターゲット
- 個人利用（1人で使用）
- 日本語対応

### 4.2 プラットフォーム
- Webアプリ（レスポンシブ対応）
- モダンブラウザ（Chrome, Firefox, Safari, Edge）

### 4.3 データ
- Cloudflare D1（SQLite互換）に保存
- 認証なし（MVPでは）

---

## 5. 技術スタック

### フロントエンド
| 技術 | 用途 |
|------|------|
| React | UIフレームワーク |
| Vite | ビルドツール |
| 自作 | カレンダーUIコンポーネント（軽量） |
| 軽量Markdownパーサー | メモ表示用（入力はテキスト） |

### バックエンド
| 技術 | 用途 |
|------|------|
| Hono | Webフレームワーク |
| Mastra | AIエージェントフレームワーク |
| Cloudflare D1 | SQLite互換データベース |
| Drizzle | ORM（D1対応） |

### インフラ（Cloudflare統一）
| サービス | 用途 |
|------|------|
| Cloudflare Workers (Frontend) | React + Vite SPA 配信 |
| Cloudflare Workers (Backend) | Hono + Mastra API |
| Cloudflare D1 | SQLite互換データベース |

### AI / 外部サービス
| 技術 | 用途 |
|------|------|
| OpenRouter | LLM API Gateway |
| OpenRouter :online | Web検索（Exa経由、$0.02/回） |
| Mastra Tool | AI Tool実行基盤 |

---

## 6. 画面構成（案）

```
┌─────────────────────────────────────────┐
│  AI Assistant Scheduler          [設定] │
├─────────────────────────────────────────┤
│  ◀ 2025年1月 ▶                          │
├────┬────┬────┬────┬────┬────┬────┤
│ 日 │ 月 │ 火 │ 水 │ 木 │ 金 │ 土 │
├────┼────┼────┼────┼────┼────┼────┤
│    │    │    │  1 │  2 │  3 │  4 │
│    │    │    │    │    │    │    │
├────┼────┼────┼────┼────┼────┼────┤
│  5 │  6 │  7 │  8 │  9 │ 10 │ 11 │
│    │    │    │    │    │ 🍝 │    │  ← 予定あり
└────┴────┴────┴────┴────┴────┴────┘

  [+ 新しい予定を追加]
```

### ポップアップ（予定クリック時）
```
┌─────────────────────────────────┐
│ 🍝 都内 レストラン 新宿         │
│ 1月10日(金) 12:00              │
├─────────────────────────────────┤
│ 📋 補足情報                     │
│ ─────────────────────────────── │
│ ## おすすめレストラン           │
│ - トラットリア○○ ⭐4.2        │
│   新宿駅東口徒歩5分            │
│   予算: 2,500円〜              │
│                                │
│ - リストランテ△△ ⭐4.5        │
│   ...                          │
├─────────────────────────────────┤
│ ✏️ メモを追加...                │
└─────────────────────────────────┘
```

---

## 7. データモデル（案）

### schedules（スケジュール）
| カラム | 型 | 説明 |
|--------|------|------|
| id | TEXT | UUID |
| title | TEXT | タイトル |
| start_at | DATETIME | 開始日時 |
| end_at | DATETIME | 終了日時（nullable） |
| created_at | DATETIME | 作成日時 |
| updated_at | DATETIME | 更新日時 |

### schedule_supplements（補足情報）
| カラム | 型 | 説明 |
|--------|------|------|
| id | TEXT | UUID |
| schedule_id | TEXT | FK → schedules |
| keywords | TEXT | 選択されたキーワード（JSON） |
| ai_result | TEXT | AI検索結果（Markdown） |
| user_memo | TEXT | ユーザーメモ（Markdown） |
| created_at | DATETIME | 作成日時 |
| updated_at | DATETIME | 更新日時 |

---

## 8. 開発フェーズ

### Phase 1: 基盤構築
- プロジェクトセットアップ（Vite + React + Hono）
- データベース設計・マイグレーション
- 基本的なAPI設計

### Phase 2: カレンダーUI
- 月表示カレンダー実装
- スケジュールCRUD
- ポップアップUI

### Phase 3: AI連携
- Mastra + OpenRouter セットアップ
- キーワード提案機能
- Web検索Tool実装

### Phase 4: 補足情報機能
- 検索結果の保存・表示
- テキストメモ入力 + Markdown表示
- UI/UX調整

---

## 9. 技術選定（全て決定済み）

| 項目 | 決定 | 理由 |
|------|------|------|
| カレンダーUI | 自作 | 軽量、要件に合わせて育てられる |
| メモ入力 | テキスト入力 | MVP優先、シンプルに |
| メモ表示 | 軽量Markdownパーサー | 表示のみMarkdown対応 |
| 検索サービス | OpenRouter :online | Exa経由、$0.02/回、追加契約不要 |
| ORM | Drizzle | Cloudflare D1対応、Honoと相性良い |
| デプロイ先 | Cloudflare | Workers + D1で統一 |
