# 2026-01-07

## カレンダー機能の本格実装

今日は「一般的なカレンダーアプリとして必要な機能」を整理して、Phase 1を全て実装した。

まずロードマップを作成。Phase 1〜6に分けて優先度順に整理した。基本機能→カテゴリ→繰り返し→通知→外部連携→高度な機能という流れ。無限に機能を追加し続けるよりも、フェーズを切って「ここまでは完了」と区切りをつけた方が進捗が見えやすい。

### スケジュール編集モーダル

既存の`ScheduleForm`コンポーネントを再利用する形で実装。`initialValues`と`mode`プロパティを追加して、作成と編集で同じフォームを使い回せるようにした。

新しいコンポーネントを作るより、既存を拡張する方がコードの一貫性が保てる。ただし、フォームが複雑になってきたらcreate用とedit用に分離することも検討すべきかもしれない。今の規模ならまだ大丈夫。

### 終日イベント対応

DBに`is_all_day`フラグを追加。UIでは終日チェックボックスをオンにすると時刻入力が非表示になる。シンプルだが、カレンダーアプリとしては必須の機能。

終日イベントの場合、`startAt`は`00:00`で統一した。終了時刻は今のところ使っていないが、将来的に複数日にまたがる終日イベントを実装するときに必要になる。

### 週表示・日表示の実装

これが今日のメイン作業。タイムライン形式で時間軸を表示し、イベントを適切な位置に配置する。

実装で気をつけた点：
- 0時〜23時の24時間分のグリッドを用意
- 終日イベントは上部に別エリアとして表示
- 時間付きイベントは開始時刻の位置に配置
- 空きスロットをクリックするとその時刻でフォームが開く

週表示は7列、日表示は1列。ロジックはほぼ同じなので共通化も考えたが、微妙にUIが違う部分もあるので今は別コンポーネントにしている。DRYを過度に追求して可読性を下げるよりは、多少の重複を許容した方がメンテしやすいこともある。

### カテゴリのDBスキーマ

Phase 2として、カテゴリ機能のDB部分だけ先に実装。`categories`テーブルと、`schedules`テーブルへの`category_id`外部キー追加。

UIはまだ作っていないが、スキーマを先に用意しておくことで、フロントエンド実装時にAPIの変更が最小限で済む。

カラーパレットは12色のプリセットを用意した。自由入力も許可しているが、UIではプリセットから選ぶ形にする予定。色の選択肢が多すぎると迷うし、見た目の統一感も損なわれる。

## 型エラーとの戦い

DB スキーマを変更すると、関連するテストやリポジトリ層で型エラーが発生する。今回は`isAllDay`を追加したことで、テストのモックデータに`isAllDay`が足りないというエラーが複数箇所で出た。

この手の作業は地味だが、型安全性のおかげで「どこを直すべきか」が明確になる。型がなければランタイムエラーになるまで気づかないところだった。TypeScriptの恩恵を感じる場面。

## 次のステップ

Phase 2の残り（カテゴリUI、検索機能）を実装すれば、日常利用で困らないレベルのカレンダーになる。Phase 3以降の繰り返しイベントや通知は、実際に使いながら必要性を判断していく。
