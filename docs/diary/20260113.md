# 2026-01-13

## やったこと

Biomeの設定をmobileパッケージからルートに移動し、プロジェクト全体に適用した。その過程で大量のlintエラーに対応した。

### 対応内容

- `a11y`ルールを全て無効化（`"all": false`）
- `useImportType`をoff（type-only importの強制は煩雑）
- `--fix --unsafe`で自動修正できるものは適用
- テストの`db as any`パターンには個別にbiome-ignoreコメント
- useEffectの依存配列警告も意図的なものはbiome-ignoreで対応
- `forEach`を`for...of`に変換
- `dangerouslySetInnerHTML`は必要な使用なのでignore

## 学び

### Biomeの設定

- カテゴリ全体を無効にするには`"all": false`（booleanが必要、`"off"`ではエラー）
- 最初`"all": "off"`と書いてしまい、biomeの設定エラーになった

### biome-ignoreコメントの配置

JSXの中で`{/* biome-ignore ... */}`を書いても効かないケースがあった。KeywordSuggestionsの`noArrayIndexKey`警告で試したが、どの位置に置いても効かなかった。結局ロジックを変更（keyからindexを除去）して対応した。

biome-ignoreはTypeScriptの`// @ts-ignore`のように、直前の行に置くのが基本だが、JSXの構造によっては認識されないことがある。

### テストの型キャスト問題

`TestDb`（better-sqlite3のDrizzleインスタンス）を`D1Database`互換として使うために`as any`が必要になっている。根本的に直すにはリポジトリの型定義を変更する必要があり、工数がかかる。今回は個別にignoreコメントで対応した。

これは技術的負債だが、テストコードなので許容範囲だと思う。

## 反省

特になし。ユーザーの指示が明確だったので、スムーズに進んだ。

「useImportTypeをoffにしていいか」「keywordだけをkeyにしていいか」など、判断が必要な箇所はユーザーに確認できた。勝手に判断せずに確認を取れたのは良かった。
